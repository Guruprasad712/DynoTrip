[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700
chown=appuser:appuser

[supervisord]
nodaemon=true
logfile=/dev/stdout
logfile_maxbytes=0
pidfile=/tmp/supervisord.pid
loglevel=info
user=appuser
directory=/app  # Changed from /tmp to /app
umask=022

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# Shared environment variables
[program:env]
environment=
    PYTHONPATH="/app",
    PYTHONUNBUFFERED="1",
    PYTHONHASHSEED="random",
    PYTHONFAULTHANDLER="1"
user=appuser

[program:mcp]
command=python -m agents.itinerary_agent.utils.agent
directory=/app
autostart=true
autorestart=unexpected
startretries=3
startsecs=5
stopwaitsecs=30
stopasgroup=true
killasgroup=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=
    PORT="8081",
    PYTHONPATH="/app",
    PYTHONUNBUFFERED="1",
    PYTHONHASHSEED="random",
    PYTHONFAULTHANDLER="1"

[program:api]
command=uvicorn api.app:app \
    --host 0.0.0.0 \
    --port %(ENV_PORT)s \
    --workers %(ENV_WEB_CONCURRENCY)s \
    --worker-class uvicorn.workers.UvicornWorker \
    --timeout-keep-alive 30 \
    --no-access-log
directory=/app
autostart=true
autorestart=true
startretries=3
startsecs=10
stopwaitsecs=30
stopasgroup=true
killasgroup=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
environment=
    PORT="8080",
    PYTHONPATH="/app",
    PYTHONUNBUFFERED="1",
    PYTHONHASHSEED="random",
    PYTHONFAULTHANDLER="1"